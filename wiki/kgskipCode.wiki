{{{

package i4nc4mp.myLock;

import android.app.KeyguardManager;
import android.app.Service;
import android.app.KeyguardManager.KeyguardLock;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.os.Handler;
import android.os.IBinder;
import android.os.RemoteException;
import android.util.Log;
import i4nc4mp.myLock.ManageKeyguard.LaunchOnKeyguardExit;

public class RemoteService extends Service {
	
	private Handler serviceHandler;
	private int counter;
	private Task myTask = new Task();
	
	boolean NeedToGuard = false;
	

	@Override
	public IBinder onBind(Intent arg0) {
		Log.d(getClass().getSimpleName(), "onBind()");
		return myRemoteServiceStub;
	}

	private IMyRemoteService.Stub myRemoteServiceStub = new IMyRemoteService.Stub() {
		public int getCounter() throws RemoteException {
			return counter;
		}
	};
	
	@Override
	public void onCreate() {
		super.onCreate();
		Log.d(getClass().getSimpleName(),"onCreate()");
	}
	
	@Override
	public void onDestroy() {
		super.onDestroy();
		serviceHandler.removeCallbacks(myTask);
		serviceHandler = null;
		Log.d(getClass().getSimpleName(),"onDestroy()");
		
		//destroy the receivers
		unregisterReceiver(skip);
	    unregisterReceiver(guard);
	}
	
	@Override
	public void onStart(Intent intent, int startId) {
		super.onStart(intent, startId);
		serviceHandler = new Handler();
		serviceHandler.postDelayed(myTask, 1000L);
		Log.d(getClass().getSimpleName(), "onStart()");
		
		//register the receivers
		IntentFilter onfilter = new IntentFilter (Intent.ACTION_SCREEN_ON);
    	IntentFilter offfilter = new IntentFilter (Intent.ACTION_SCREEN_OFF);
    	registerReceiver(skip, onfilter);
    	registerReceiver(guard, offfilter);
	}
	
	class Task implements Runnable {
		public void run() {
			//++counter;
			//serviceHandler.postDelayed(this,1000L);
			
			//if (NeedToGuard) Log.i(getClass().getSimpleName(), "NTG: True");
			//else Log.i(getClass().getSimpleName(), "NTG: False");
				//don't need any more tracking right now since we know it is working
			
			}
		    	
		}
	
	BroadcastReceiver skip = new BroadcastReceiver() {
		
		public static final String TAG = "skipKeyguard";
		public static final String Screen = "android.intent.action.SCREEN_ON";

		@Override
		public void onReceive(Context context, Intent intent) {
			if (!intent.getAction().equals(Screen)) return;
			
			Log.v(TAG, "Screen just went ON!");//marks that we received the broadcast
			
		ManageKeyguard.disableKeyguard(context);
			    	  
			} 
			  
	};
	
	BroadcastReceiver guard = new BroadcastReceiver() {
        
        public static final String TAG = "reguard";
        public static final String Screenoff = "android.intent.action.SCREEN_OFF";

        @Override
        public void onReceive(Context context, Intent intent) {
                if (!intent.getAction().equals(Screenoff)) return;
                
                Log.v(TAG, "Screen just went OFF");
                
                ManageKeyguard.reenableKeyguard();
                
                }
};
	
	
	
	}

}}}